{"remainingRequest":"F:\\workspace\\jf_front_end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\workspace\\jf_front_end\\src\\views\\demo\\business\\issues\\142\\edit-cache-db.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\workspace\\jf_front_end\\src\\views\\demo\\business\\issues\\142\\edit-cache-db.vue","mtime":1590460801120},{"path":"F:\\workspace\\jf_front_end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\workspace\\jf_front_end\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\workspace\\jf_front_end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\workspace\\jf_front_end\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBtYXBBY3Rpb25zIH0gZnJvbSAndnVleCcNCmltcG9ydCBiYXNlIGZyb20gJy4vbWl4aW5zL2luZGV4Jw0KZXhwb3J0IGRlZmF1bHQgew0KICBtaXhpbnM6IFsNCiAgICBiYXNlDQogIF0sDQogIC8vIOesrOS4gOasoei/m+WFpeaIluS7juWFtuS7lue7hOS7tuWvueW6lOi3r+eUsei/m+WFpeaXtuinpuWPkQ0KICBiZWZvcmVSb3V0ZUVudGVyICh0bywgZnJvbSwgbmV4dCkgew0KICAgIGNvbnN0IGlkID0gdG8ucGFyYW1zLmlkDQogICAgaWYgKGlkKSB7DQogICAgICBuZXh0KGFzeW5jIGluc3RhbmNlID0+IHsNCiAgICAgICAgaWYgKGZyb20ubmFtZSA9PT0gJ2RlbW8tYnVzaW5lc3MtaXNzdWVzLTE0MicpIHsNCiAgICAgICAgICBhd2FpdCBpbnN0YW5jZS5nZXRGb3JtRGF0YShpZCkNCiAgICAgICAgICBpbnN0YW5jZS5zYXZlRGF0YVRvRGIoKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGluc3RhbmNlLmxvYWREYXRhRnJvbURiKHRvKQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0NCiAgfSwNCiAgLy8g5Zyo5ZCM5LiA57uE5Lu25a+55bqU55qE5aSa5Liq6Lev55Sx6Ze05YiH5o2i5pe26Kem5Y+RDQogIGJlZm9yZVJvdXRlVXBkYXRlICh0bywgZnJvbSwgbmV4dCkgew0KICAgIGNvbnN0IGlkID0gdG8ucGFyYW1zLmlkDQogICAgaWYgKGlkKSB7DQogICAgICB0aGlzLmxvYWREYXRhRnJvbURiKHRvKQ0KICAgICAgbmV4dCgpDQogICAgfQ0KICB9LA0KICB3YXRjaDogew0KICAgIC8vIOihqOWNleWPmOWMlueahOaXtuWAmeabtOaWsOaMgeS5heWMlg0KICAgIGZvcm06IHsNCiAgICAgIGhhbmRsZXIgKCkgew0KICAgICAgICB0aGlzLnNhdmVEYXRhVG9EYigpDQogICAgICB9LA0KICAgICAgZGVlcDogdHJ1ZQ0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIC4uLm1hcEFjdGlvbnMoJ2QyYWRtaW4vZGInLCBbDQogICAgICAncGFnZVNldCcsDQogICAgICAncGFnZUdldCcNCiAgICBdKSwNCiAgICAvLyDlsIbpobXpnaLmlbDmja7lkIzmraXliLDmjIHkuYXljJblrZjlgqgNCiAgICBzYXZlRGF0YVRvRGIgKCkgew0KICAgICAgdGhpcy5wYWdlU2V0KHsgaW5zdGFuY2U6IHRoaXMsIHVzZXI6IHRydWUgfSkNCiAgICB9LA0KICAgIC8vIOS7juaMgeS5heWMluWtmOWCqOaBouWkjeaVsOaNruWIsOmhtemdog0KICAgIGFzeW5jIGxvYWREYXRhRnJvbURiICh0bykgew0KICAgICAgY29uc3QgaW5zdGFuY2UgPSB7DQogICAgICAgICRyb3V0ZTogew0KICAgICAgICAgIGZ1bGxQYXRoOiB0by5mdWxsUGF0aA0KICAgICAgICB9LA0KICAgICAgICAkZGF0YToge30NCiAgICAgIH0NCiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLnBhZ2VHZXQoew0KICAgICAgICBpbnN0YW5jZSwNCiAgICAgICAgdXNlcjogdHJ1ZQ0KICAgICAgfSkNCiAgICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHsNCiAgICAgICAgdGhpc1trZXldID0gZGF0YVtrZXldDQogICAgICB9DQogICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ2xvYWREYXRhRnJvbURiJykNCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["edit-cache-db.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAuBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"edit-cache-db.vue","sourceRoot":"src/views/demo/business/issues/142","sourcesContent":["<template>\r\n  <d2-container\r\n    type=\"card\"\r\n    class=\"page\">\r\n    <el-form\r\n      ref=\"form\"\r\n      :model=\"form\"\r\n      label-width=\"80px\"\r\n      class=\"page--form\">\r\n      <el-form-item label=\"姓名\">\r\n        <el-input v-model=\"form.name\"/>\r\n      </el-form-item>\r\n      <el-form-item label=\"地址\">\r\n        <el-input type=\"textarea\" v-model=\"form.address\"/>\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"handleSubmit\">修改</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n  </d2-container>\r\n</template>\r\n\r\n<script>\r\nimport { mapActions } from 'vuex'\r\nimport base from './mixins/index'\r\nexport default {\r\n  mixins: [\r\n    base\r\n  ],\r\n  // 第一次进入或从其他组件对应路由进入时触发\r\n  beforeRouteEnter (to, from, next) {\r\n    const id = to.params.id\r\n    if (id) {\r\n      next(async instance => {\r\n        if (from.name === 'demo-business-issues-142') {\r\n          await instance.getFormData(id)\r\n          instance.saveDataToDb()\r\n        } else {\r\n          instance.loadDataFromDb(to)\r\n        }\r\n      })\r\n    }\r\n  },\r\n  // 在同一组件对应的多个路由间切换时触发\r\n  beforeRouteUpdate (to, from, next) {\r\n    const id = to.params.id\r\n    if (id) {\r\n      this.loadDataFromDb(to)\r\n      next()\r\n    }\r\n  },\r\n  watch: {\r\n    // 表单变化的时候更新持久化\r\n    form: {\r\n      handler () {\r\n        this.saveDataToDb()\r\n      },\r\n      deep: true\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapActions('d2admin/db', [\r\n      'pageSet',\r\n      'pageGet'\r\n    ]),\r\n    // 将页面数据同步到持久化存储\r\n    saveDataToDb () {\r\n      this.pageSet({ instance: this, user: true })\r\n    },\r\n    // 从持久化存储恢复数据到页面\r\n    async loadDataFromDb (to) {\r\n      const instance = {\r\n        $route: {\r\n          fullPath: to.fullPath\r\n        },\r\n        $data: {}\r\n      }\r\n      const data = await this.pageGet({\r\n        instance,\r\n        user: true\r\n      })\r\n      for (const key in data) {\r\n        this[key] = data[key]\r\n      }\r\n      this.$message.success('loadDataFromDb')\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.page {\r\n  .page--form {\r\n    max-width: 460px;\r\n  }\r\n}\r\n</style>\r\n"]}]}